<!DOCTYPE html>
<head>
    <style>
      body, html {padding: 0; margin: 0; overflow: hidden; height:100%;}
    </style>
</head>

<body>
  <canvas id="canvas"/>
</body>
<script type="application/x-javascript">
  // utils
  function map(n, start1, stop1, start2, stop2){
    return ((n-start1)/(stop1-start1))*(stop2-start2)+start2;
  }

  function lerp(a, b, n) {
    return (b - a) * n + a;
  }

  function lerpColor(colorA, colorB, amt){
    let r = lerp(colorA.r, colorB.r, amt);
    let g = lerp(colorA.g, colorB.g, amt);
    let b = lerp(colorA.b, colorB.b, amt);
      return 'rgba(' + r +',' + g +','+ b +',1)';
  }

  function rgba(x){
    return 'rgba(' + x.r +',' + x.g +','+ x.b +',1)'
  }

  function constrain(x, min, max){
    x = Math.max(x, max);
    x = Math.min(x, min);
    return x;
  }

</script>
<script type="application/javascript">
    let frameCount = 0;
    let c, w, h;
    let canvas = document.getElementById("canvas");
    c = canvas.getContext("2d");
    let colorBackground = {
      r: 12,
      g: 80,
      b: 160
    }
    let color = 'rgba()'
    let colorForeground = {
      r: 255,
      g: 255,
      b: 255
    }

    function updateCanvasSize(){
        width = window.innerWidth;
        height = window.innerHeight;
        canvas.width = width;
        canvas.height = height;
    }

    function update(time){
      frameCount++;
      time *= 0.001;
      updateCanvasSize();
      c.resetTransform();
      c.clearRect(0,0,width,height);
      c.fillStyle = rgba(colorBackground);
      c.fillRect(0,0, width, height);

      drawInnerMandala(time);
      drawMiddlePlanets(time);

      requestAnimationFrame(update);
    }

    function drawMiddlePlanets(time){
      let count = 80;
      let maxSize = 40;
      for(let i = 0; i < count; i++){
        let iNorm = map(i, 0, count - 1, 0, 1);
        let theta = Math.PI * 40 * iNorm - time;
        let radius = 400;
        let x = radius * Math.cos(theta);
        let y = radius * Math.sin(theta);
        c.fillStyle = lerpColor(colorBackground, colorForeground, Math.pow(1-iNorm,2.5));
        setTransform(c, width / 2, height / 2);
        c.translate(x, y);
        let size = maxSize-iNorm*maxSize;
        if(size < 5){
          continue;
        }
        for(let corner = 0; corner < 1; corner++){
          c.fillRect(0,0,size,size);
        }
      }
      c.resetTransform();
    }

    function drawInnerMandala(time){
      let count = 100;
      let maxSize = 300;
      for(let i = 1; i < count; i++){
        setTransform(c, width / 2, height / 2);
        let iNorm = map(i, 1, count-1, 0, 1);
        c.rotate(iNorm * Math.PI * 30 * Math.cos(time*0.1));
        let size = maxSize-iNorm*maxSize;
        c.strokeStyle = lerpColor(colorBackground, colorForeground, Math.pow(1-iNorm, 0.3));
        c.fillStyle = lerpColor(colorBackground, colorForeground, Math.pow(iNorm, 0.9));
        c.beginPath();
        c.lineWidth = 6+iNorm*6;
        c.lineTo(size, 0);
        for(let corner = 0; corner < 4; corner++){
          c.rotate(Math.PI / 2);
          c.lineTo(size, 0);
        }
        c.fill();
        c.stroke();
      }
      c.resetTransform();
    }

    function setTransform(c, x, y){
      c.setTransform(1, 0, 0, 1, x, y);
    }
    requestAnimationFrame(update);


</script>
